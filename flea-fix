#!/bin/ksh
#
#  fixes flea output 

#set -o xtrace

case $1 in
'') echo "$0 [-o] file.ps ...   (-o = overwrite)"; exit;;
esac

arg=$1
case $arg in
'-o') shift;
esac

for i in $*
do
  outfile=`basename $i .ps`.fix.ps
  case $arg in
  '-o') outfile=$i;
  esac

  # parse self for data
  a=`grep -n "(U) 1815 3049 -1815" $0 | tail -1 | cut -f1 -d:`
  b=`wc -l $0 | cut -f1 -d" "`

  # parse input
  x=`grep -n "(U) 2014 3049 -2014" $i | cut -f1 -d:`
  y=`grep -n "(n) 406 3110 -406" $i | cut -f1 -d:`
  z=`wc -l $i | cut -f1 -d" "`
  case $x in
  '') echo "File $i is not a EECS 241 - style flea file."; exit;;
  esac
  ((x=x-1))
  ((y=y+1))

  #build output
  sed -n 1,${x}p $i > /tmp/..head
  sed -n $y,${z}p $i > /tmp/..tail
  sed -n $a,${b}p $0 > /tmp/..mid
  cat /tmp/..head /tmp/..mid /tmp/..tail > $outfile
  yes | replace "%! Flea output file" "%!PS-Adobe" $outfile
  /bin/rm /tmp/..head /tmp/..mid /tmp/..tail

done

exit

--
(U) 1815 3049 -1815 -3049 180 1815 3049 40 text
(.) 1786 3049 -1786 -3049 180 1786 3049 40 text
(C) 1758 3049 -1758 -3049 180 1758 3049 40 text
(.) 1729 3049 -1729 -3049 180 1729 3049 40 text
( ) 1701 3049 -1701 -3049 180 1701 3049 40 text
(B) 1672 3049 -1672 -3049 180 1672 3049 40 text
(e) 1643 3049 -1643 -3049 180 1643 3049 40 text
(r) 1615 3049 -1615 -3049 180 1615 3049 40 text
(k) 1586 3049 -1586 -3049 180 1586 3049 40 text
(e) 1558 3049 -1558 -3049 180 1558 3049 40 text
(l) 1529 3049 -1529 -3049 180 1529 3049 40 text
(e) 1501 3049 -1501 -3049 180 1501 3049 40 text
(y) 1472 3049 -1472 -3049 180 1472 3049 40 text
( ) 1444 3049 -1444 -3049 180 1444 3049 40 text
(C) 1415 3049 -1415 -3049 180 1415 3049 40 text
(o) 1387 3049 -1387 -3049 180 1387 3049 40 text
(m) 1358 3049 -1358 -3049 180 1358 3049 40 text
(p) 1330 3049 -1330 -3049 180 1330 3049 40 text
(u) 1301 3049 -1301 -3049 180 1301 3049 40 text
(t) 1273 3050 -1273 -3050 180 1273 3050 40 text
(e) 1244 3050 -1244 -3050 180 1244 3050 40 text
(r) 1215 3050 -1215 -3050 180 1215 3050 40 text
( ) 1187 3050 -1187 -3050 180 1187 3050 40 text
(S) 1158 3050 -1158 -3050 180 1158 3050 40 text
(c) 1130 3050 -1130 -3050 180 1130 3050 40 text
(i) 1101 3050 -1101 -3050 180 1101 3050 40 text
(e) 1073 3050 -1073 -3050 180 1073 3050 40 text
(n) 1044 3050 -1044 -3050 180 1044 3050 40 text
(c) 1016 3050 -1016 -3050 180 1016 3050 40 text
(e) 987 3050 -987 -3050 180 987 3050 40 text
( ) 959 3050 -959 -3050 180 959 3050 40 text
(D) 930 3050 -930 -3050 180 930 3050 40 text
(i) 902 3050 -902 -3050 180 902 3050 40 text
(v) 873 3050 -873 -3050 180 873 3050 40 text
(i) 844 3050 -844 -3050 180 844 3050 40 text
(s) 816 3050 -816 -3050 180 816 3050 40 text
(i) 787 3050 -787 -3050 180 787 3050 40 text
(o) 759 3050 -759 -3050 180 759 3050 40 text
(n) 730 3050 -730 -3050 180 730 3050 40 text
(C) 1738 3109 -1738 -3109 180 1738 3109 60 text
(S) 1695 3109 -1695 -3109 180 1695 3109 60 text
( ) 1652 3109 -1652 -3109 180 1652 3109 60 text
(2) 1609 3109 -1609 -3109 180 1609 3109 60 text
(5) 1566 3109 -1566 -3109 180 1566 3109 60 text
(4) 1523 3109 -1523 -3109 180 1523 3109 60 text
( ) 1480 3109 -1480 -3109 180 1480 3109 60 text
(-) 1437 3109 -1437 -3109 180 1437 3109 60 text
( ) 1394 3109 -1394 -3109 180 1394 3109 60 text
(A) 1351 3109 -1351 -3109 180 1351 3109 60 text
(d) 1308 3109 -1308 -3109 180 1308 3109 60 text
(v) 1266 3110 -1266 -3110 180 1266 3110 60 text
(a) 1223 3110 -1223 -3110 180 1223 3110 60 text
(n) 1180 3110 -1180 -3110 180 1180 3110 60 text
(c) 1137 3110 -1137 -3110 180 1137 3110 60 text
(e) 1094 3110 -1094 -3110 180 1094 3110 60 text
(d) 1051 3110 -1051 -3110 180 1051 3110 60 text
( ) 1008 3110 -1008 -3110 180 1008 3110 60 text
(V) 965 3110 -965 -3110 180 965 3110 60 text
(L) 922 3110 -922 -3110 180 922 3110 60 text
(S) 879 3110 -879 -3110 180 879 3110 60 text
(I) 836 3110 -836 -3110 180 836 3110 60 text
